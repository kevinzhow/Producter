var SwipeView=function(t,e){function s(t){return""===a?t:(t=t.charAt(0).toUpperCase()+t.substr(1),a+t)}var i=e.createElement("div").style,a=function(){for(var t="t,webkitT,MozT,msT,OT".split(","),e,s=0,a=t.length;a>s;s++)if(e=t[s]+"ransform",e in i)return t[s].substr(0,t[s].length-1);return!1}(),h=a?"-"+a.toLowerCase()+"-":"",n=s("transform"),r=s("transitionDuration"),o=s("perspective")in i,p="ontouchstart"in t,g=!!a,d=s("transition")in i,c=o?" translateZ(0)":"",l="onorientationchange"in t?"orientationchange":"resize",m=p?"touchstart":"mousedown",u=p?"touchmove":"mousemove",v=p?"touchend":"mouseup",P=p?"touchcancel":"mouseup",f=function(){if(a===!1)return!1;var t={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return t[a]}(),w=function(s,i){var n,r,o,p;this.wrapper="string"==typeof s?e.querySelector(s):s,this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,loop:!0};for(n in i)this.options[n]=i[n];for(this.wrapper.style.overflow="hidden",this.wrapper.style.position="relative",this.masterPages=[],r=e.createElement("div"),r.id="swipeview-slider",r.style.cssText="position:relative;top:0;height:100%;width:100%;"+h+"transition-duration:0;"+h+"transform:translateZ(0);"+h+"transition-timing-function:ease-out",this.wrapper.appendChild(r),this.slider=r,this.refreshSize(),n=-1;2>n;n++)r=e.createElement("div"),r.id="swipeview-masterpage-"+(n+1),r.style.cssText=h+"transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+100*n+"%",r.dataset||(r.dataset={}),p=-1==n?this.options.numberOfPages-1:n,r.dataset.pageIndex=p,r.dataset.upcomingPageIndex=p,this.options.loop||-1!=n||(r.style.visibility="hidden"),this.slider.appendChild(r),this.masterPages.push(r);o=this.masterPages[1].className,this.masterPages[1].className=o?o+" swipeview-active":"swipeview-active",t.addEventListener(l,this,!1),this.wrapper.addEventListener(m,this,!1),this.wrapper.addEventListener(u,this,!1),this.wrapper.addEventListener(v,this,!1),this.slider.addEventListener(f,this,!1),"O"==a&&this.slider.addEventListener(f.toLowerCase(),this,!1)};return w.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(t){this.wrapper.addEventListener("swipeview-flip",t,!1),this.customEvents.push(["flip",t])},onMoveOut:function(t){this.wrapper.addEventListener("swipeview-moveout",t,!1),this.customEvents.push(["moveout",t])},onMoveIn:function(t){this.wrapper.addEventListener("swipeview-movein",t,!1),this.customEvents.push(["movein",t])},onTouchStart:function(t){this.wrapper.addEventListener("swipeview-touchstart",t,!1),this.customEvents.push(["touchstart",t])},destroy:function(){for(;this.customEvents.length;)this.wrapper.removeEventListener("swipeview-"+this.customEvents[0][0],this.customEvents[0][1],!1),this.customEvents.shift();t.removeEventListener(l,this,!1),this.wrapper.removeEventListener(m,this,!1),this.wrapper.removeEventListener(u,this,!1),this.wrapper.removeEventListener(v,this,!1),this.slider.removeEventListener(f,this,!1)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.pageWidth=this.wrapperWidth,this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth,this.snapThreshold=null===this.options.snapThreshold?Math.round(.15*this.pageWidth):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(t){this.options.numberOfPages=t,this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth},goToPage:function(t){var e;for(this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,""),e=0;3>e;e++)className=this.masterPages[e].className,/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[e].className=className?className+" swipeview-loading":"swipeview-loading");t=0>t?0:t>this.options.numberOfPages-1?this.options.numberOfPages-1:t,this.page=t,this.pageIndex=t,this.slider.style[r]="0s",this.__pos(-t*this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className+" swipeview-active",0===this.currentMasterPage?(this.masterPages[2].style.left=100*this.page-100+"%",this.masterPages[0].style.left=100*this.page+"%",this.masterPages[1].style.left=100*this.page+100+"%",this.masterPages[2].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[0].dataset.upcomingPageIndex=this.page,this.masterPages[1].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):1==this.currentMasterPage?(this.masterPages[0].style.left=100*this.page-100+"%",this.masterPages[1].style.left=100*this.page+"%",this.masterPages[2].style.left=100*this.page+100+"%",this.masterPages[0].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[1].dataset.upcomingPageIndex=this.page,this.masterPages[2].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):(this.masterPages[1].style.left=100*this.page-100+"%",this.masterPages[2].style.left=100*this.page+"%",this.masterPages[0].style.left=100*this.page+100+"%",this.masterPages[1].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[2].dataset.upcomingPageIndex=this.page,this.masterPages[0].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1),this.__flip()},next:function(){(this.options.loop||this.x!=this.maxX)&&(this.directionX=-1,this.x-=1,this.__checkPosition())},prev:function(){(this.options.loop||0!==this.x)&&(this.directionX=1,this.x+=1,this.__checkPosition())},handleEvent:function(t){switch(t.type){case m:this.__start(t);break;case u:this.__move(t);break;case P:case v:this.__end(t);break;case l:this.__resize();break;case f:case"otransitionend":t.target!=this.slider||this.options.hastyPageFlip||this.__flip()}},__pos:function(t){this.x=t,this.slider.style[n]="translate("+t+"px,0)"+c},__resize:function(){this.refreshSize(),this.slider.style[r]="0s",this.__pos(-this.page*this.pageWidth)},__start:function(t){if(!this.initiated){var e=p?t.touches[0]:t;this.initiated=!0,this.moved=!1,this.thresholdExceeded=!1,this.startX=e.pageX,this.startY=e.pageY,this.pointX=e.pageX,this.pointY=e.pageY,this.stepsX=0,this.stepsY=0,this.directionX=0,this.directionLocked=!1,this.slider.style[r]="0s",this.__event("touchstart")}},__move:function(t){if(this.initiated){var e=p?t.touches[0]:t,s=e.pageX-this.pointX,i=e.pageY-this.pointY,a=this.x+s,h=Math.abs(e.pageX-this.startX);if(this.moved=!0,this.pointX=e.pageX,this.pointY=e.pageY,this.directionX=s>0?1:0>s?-1:0,this.stepsX+=Math.abs(s),this.stepsY+=Math.abs(i),!(this.stepsX<10&&this.stepsY<10)){if(!this.directionLocked&&this.stepsY>this.stepsX)return void(this.initiated=!1);t.preventDefault(),this.directionLocked=!0,!this.options.loop&&(a>0||a<this.maxX)&&(a=this.x+s/2),!this.thresholdExceeded&&h>=this.snapThreshold?(this.thresholdExceeded=!0,this.__event("moveout")):this.thresholdExceeded&&h<this.snapThreshold&&(this.thresholdExceeded=!1,this.__event("movein")),this.__pos(a)}}},__end:function(t){if(this.initiated){var e=p?t.changedTouches[0]:t,s=Math.abs(e.pageX-this.startX);if(this.initiated=!1,this.moved)return!this.options.loop&&(this.x>0||this.x<this.maxX)&&(s=0,this.__event("movein")),s<this.snapThreshold?(this.slider.style[r]=Math.floor(300*s/this.snapThreshold)+"ms",void this.__pos(-this.page*this.pageWidth)):void this.__checkPosition()}},__checkPosition:function(){var t,e,s;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,""),this.directionX>0?(this.page=-Math.ceil(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=0===this.pageIndex?this.options.numberOfPages-1:this.pageIndex-1,t=this.currentMasterPage-1,t=0>t?2:t,this.masterPages[t].style.left=100*this.page-100+"%",e=this.page-1):(this.page=-Math.floor(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+1,t=this.currentMasterPage+1,t=t>2?0:t,this.masterPages[t].style.left=100*this.page+100+"%",e=this.page+1),s=this.masterPages[this.currentMasterPage].className,/(^|\s)swipeview-active(\s|$)/.test(s)||(this.masterPages[this.currentMasterPage].className=s?s+" swipeview-active":"swipeview-active"),s=this.masterPages[t].className,/(^|\s)swipeview-loading(\s|$)/.test(s)||(this.masterPages[t].className=s?s+" swipeview-loading":"swipeview-loading"),e-=Math.floor(e/this.options.numberOfPages)*this.options.numberOfPages,this.masterPages[t].dataset.upcomingPageIndex=e,newX=-this.page*this.pageWidth,this.slider.style[r]=Math.floor(500*Math.abs(this.x-newX)/this.pageWidth)+"ms",this.options.loop||(this.masterPages[t].style.visibility=0===newX||newX==this.maxX?"hidden":""),this.x==newX?this.__flip():(this.__pos(newX),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");for(var t=0;3>t;t++)this.masterPages[t].className=this.masterPages[t].className.replace(/(^|\s)swipeview-loading(\s|$)/,""),this.masterPages[t].dataset.pageIndex=this.masterPages[t].dataset.upcomingPageIndex},__event:function(t){var s=e.createEvent("Event");s.initEvent("swipeview-"+t,!0,!0),this.wrapper.dispatchEvent(s)}},w}(window,document);